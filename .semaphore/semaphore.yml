version: v1.0
name: AppSignal for Python
auto_cancel:
  running:
    when: branch != 'main' AND branch != 'develop'
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu2004
global_job_config:
  prologue:
    commands:
    - checkout
blocks:
- name: Linters
  dependencies: []
  task:
    jobs:
    - name: Style
      commands:
      - "sem-version python 3.12"
      - "pip install hatch"
      - "hatch -v run lint:style"
    - name: Typing
      commands:
      - "sem-version python 3.12"
      - "pip install hatch"
      - "hatch -v run lint:typing"
    - name: Git Lint (Lintje)
      commands:
      - script/lint_git
- name: Tests
  dependencies: []
  task:
    jobs:
    - name: Diagnose tests
      env_vars:
        - name: LANGUAGE
          value: python
      commands:
        - "sem-version python 3.12"
        - "pip install hatch"
        - git submodule init
        - git submodule update
        - ./tests/diagnose/bin/test
    - name: Python 3.8
      commands:
      - "sem-version python 3.8"
      - "pip install hatch"
      - "hatch -v run test.py38:pytest"
    - name: Python 3.9
      commands:
      - "sem-version python 3.9"
      - "pip install hatch"
      - "hatch -v run test.py39:pytest"
    - name: Python 3.10
      commands:
      - "sem-version python 3.10"
      - "pip install hatch"
      - "hatch -v run test.py310:pytest"
    - name: Python 3.11
      commands:
      - "sem-version python 3.11"
      - "pip install hatch"
      - "hatch -v run test.py311:pytest"
    - name: Python 3.12
      commands:
      - "sem-version python 3.12"
      - "pip install hatch"
      - "hatch -v run test.py312:pytest"
